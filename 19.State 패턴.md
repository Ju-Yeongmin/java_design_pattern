# 19. State 패턴
상태를 클래스로 표현한다

<br>

## State 패턴이란?
Java에서 객체지향 프로그래밍을 할 때 프로그래밍 대상을 '클래스'로 표현한다. <br>
이때 클래스에 대응하느 구체적인 '사물'이 현실에 존재할 수도 있고, 그렇지 않을수도 있다. <br>

State 패턴에서는 '상태'를 클래스로 표현한다. State란 사물이나 현상이 놓여있는 모양을 의미하는데, <br>
일반적으로는 상태를 사물로 인식하는 경우가 거의 없기 때문에, 상태를 클래스로 표현하는 것이 어려울 수 있다. <br>
이 장에서는 상태를 클래스로 표현하는 방법을 알아보자. <br>

상태를 클래스로 표현하면 클래스를 전환함으로써 '상태 변화'를 나타낼 수 있으며, 새로운 상태를 추가할 때 <br>
무엇을 프로그래밍해야 할지 명확해진다.

<br>

## 예제 프로그램 (금고 경비 시스템)
시간마다 경비 상태가 변화하는 금고 경비 시스템을 생각해보자.

<img width="454" alt="image" src="https://github.com/Ju-Yeongmin/java_design_pattern/assets/110506500/bd78eee8-9184-41b0-a4ce-d977160daf36">

다만, 실제로 경비 센터를 호출할 수는 없으므로 화면에 호출 상황을 표시하는 것으로 대체한다. <br>
실행시키면 아래와 같은 모습으로 동작한다.

<img width="463" alt="image" src="https://github.com/Ju-Yeongmin/java_design_pattern/assets/110506500/60141caa-c6e1-41e6-ac56-f2a472e3218e">

위와 같은 형태를 구현한다면 각자 어떻게 구현할 것인지 생각해보자.

<br>

1) State 패턴을 쓰지 않을 때
```java
경비 시스템 클래스 {
  금고 사용시 호출되는 메서드() {
    if (주간) {
      경비 센터에 사용 기록
    } else if (야간) {
      경비 센터에 비상 상황 통보
    }
  }

  비상벨 사용시 호출되는 메서드() {
    경비 센터에 비상 상황 통보
  }

  일반 통화 시 호출되는 메서드() {
    if (주간) {
      경비 센터 호출
    } else if (야간) {
      경비 센터 자동 응답기 호출
    }
  } 
}
```

<br>

2) State 패턴을 사용할 때
```java
주간 상태를 표현하는 클래스 {
  금고 사용 시 호출되는 메서드() {
    경비 센터에 사용 기록
  }

  비상벨 사용 시 호출되는 메서드() {
    경비 센터에 비상벨 통보
  }

  일반 통화 시 호출되는 메서드() {
    경비 센터 호출
  }
}

야간 상태를 표현하는 클래스 {
  금고 사용 시 호출되는 메서드() {
    경비 센터에 비상 상황 통보
  }

  비상벨 사용 시 호출되는 메서드() {
    경비 센터에 비상벨 통보
  }

  일반 통화 시 호출되는 메서드() {
    경비 센터 자동 응답기 호출
  }
}
```

<br>

1번의 방법이 틀린 것은 절대 아니다. 하지만 State 패턴을 사용한다면 전혀 다른 관점에서 처리할 수 있다. <br>
두 코드의 차이를 살펴보면, State를 사용하지 않는 1번 코드에서 주간/야간 이라는 상태값은 각 메서드의 <br>
if문 부분에 등장한다. 그리고 각 메서드 안에서 현재 상태를 체크한다. <br>

반면에, State 패턴을 사용한 2번 코드에서는 주간/야간 이라는 상태를 클래스로 표현했다. <br>
상태가 클래스로 표현되어 있기 때문에 각 메서드에서는 현재 상태를 체크하는 if 문이 등장하지 않는다. <br>

상태가 메서드 안에 기술되어 있던 1번의 형태에서 바깥쪽으로 끌어낸 모습이다. <br>

<br>

## 사고를 넓혀주는 힌트

### 분할해서 통치하라
복잡하고 규모가 큰 프로그램을 사용할 경우 문제를 그대로 해결하러 하지 마라.<br>
큰 문제를 먼저 작은 문제들로 나누어라. 그래도 해결하기 힘들다면 더 작은 문제로 나누어라. <br>
간단하게 얘기하면 크고 까다로운 문제를 푸는 대신 작고 쉬운 문제 여러개를 해결하라는 의미. <br>

State 패턴에서 상태를 클래스로 표한한다. 각각의 구체적인 상태를 다른 클래스로 표현해서 문제를<br>
분할하여 해결한 것. 하나의 State 역을 코딩하다 보면 프로그래머는 다른 클래스를 머리에서 <br>
잊고 집중할 수 있다. 금고 경비 시스템처럼 상태가 두가지 밖에 없다면 별로 고마움을 <br>
느끼지 못하지만 상태가 많을수록 State 패턴은 강점을 발휘한다. <br>

이처럼 State 패턴은 시스템의 상태를 클래스로 표현함으로써 복잡한 프로그램을 분할한다. <br>

<br>

### 자기 모순에 빠지지 말자
State 패턴을 사용하지 않고 시스템 상태가 여러 변숫값의 집합으로 표현되고 있다고 하면 <br>
이때 변숫값 사이에 자기 모순이나 불일치가 없어야 한다. <br>

State 패턴에서는 상태를 클래스로 표현하기 때문에 현재 상태를 나타내는 변수는 단 하나이다. <br>
state 필드의 값이 시스템의 상태를 확실하게 결정하므로 자기 모순을 내포한 상태라는 것이 <br>
존재하지 않게 된다. <br>

<br>

### 새로운 상태를 추가하는 것은 간단하다
State 패턴에서 새로운 상태를 추가하는 것은 간단하다. 새로운 State를 표현한 xxxState 클래스를 <br>
만들고 필요한 메서드만 만들면 되기 때문이다. 만약 State 패턴을 사용하지 않았다면 상태를 판단하는 <br>
if 조건문을 메서드마다 작성해야 하기 때문에 구현이 까다로우며 에러처리가 힘들어진다. <br>

<br>




